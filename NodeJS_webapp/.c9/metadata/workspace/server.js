{"changed":true,"filter":false,"title":"server.js","tooltip":"/server.js","value":"var express = require('express'),\n    app = express(),\n    fs = require(\"fs\"),\n    mailer = require(\"nodemailer\"),\n    port = process.env.PORT || 8080,\n    mongoose = require('mongoose');\n\nrequire(\"./models/todo\");\nvar todoController = require('./controllers/todo');\n\n// mongoose.connect(\"mongodb://arjun:@rJun@ds029793.mongolab.com:29793/pally\");\n// mongodb://<dbuser>:<dbpassword>@ds029793.mongolab.com:29793/pally\n// mongodb://<user>:<password>@ds045027.mongolab.com:45027/database\napp.use(express.json());\napp.use(express.urlencoded());\napp.use(express.logger());\napp.set('view engine', 'ejs');\n\n// Email settings\nvar smtpTransport = mailer.createTransport(\"SMTP\", {\n    service: \"gmail\",\n    auth: {\n        user: \"noreply.pallyapp@gmail.com\",\n        pass: \"pally@123\"\n    }\n});\n\n\n//Requests\n\napp.get(\"/index\", function(req, res) {\n    res.render('index.html');\n});\n\napp.get(\"/meet_our_team\", function(req, res) {\n    res.render('meet_our_team.html');\n});\n\n\napp.get(\"/talkToUs\", function(req, res) {\n    res.render('talkToUs.html');\n});\n\napp.get(\"/privacy\", function(req, res) {\n    res.render('privacy.html');\n});\n\napp.get(\"/what_is_pally\", function(req, res) {\n    res.render('what_is_pally.html');\n});\n\napp.post('/sendEmail', function(req, res) {\n    console.log(req.body.userEmail);\n    // Use Smtp Protocol to send Email\n    // var smtpTransport = mailer.createTransport(\"SMTP\",{\n    //     host: 'smtp.pallyapp.com',\n    //     port: 25,\n    //     auth: {\n    //         user: 'team@pallyapp.com',\n    //         pass: 'brooklyn88'\n    //     }\n    // });\n\n    var mail = {\n        from: \"Pally <team@pallyapp.com>\",\n        to: req.body.userEmail,\n        subject: \"Thank You!\",\n        text: \"Hi there!\\nThank you for signing up to Pally! We'll be launching to the public soon. Sit tight for our updates! Oh, and we promise to never spam you with useless information.\\nWith love,\\nTeam Pally\",\n        html: fs.readFileSync('./client/thankYouSignup.html').toString()\n    };\n\n    smtpTransport.sendMail(mail, function(error, response) {\n        if (error) {\n            console.error(error.stack);\n        }\n        else {\n            console.log(\"Message sent: \" + response.message);\n        }\n\n        smtpTransport.close();\n    });\n    // subscriber(req.body);\n    res.render(\"index.html\");\n});\n\napp.post('/sendFeedback', function(req, res) {\n    console.log(req.body.userEmail);\n\n    var mail = {\n        from: \"Pally <team@pallyapp.com>\",\n        to: req.body.userEmail,\n        subject: \"Thank You for your Feedback!\",\n        text: \"Hi there!\\nThank you for your interest in Pally! One of our team members will review your message and get back to you as soon as possible (usually within 24 hours).\\nIn the meantime, please tell your friends about Pally!\\nSincerely,\\nTeam Pally\",\n        html: fs.readFileSync('./client/thankYouFeedback.html').toString()\n    };\n\n    smtpTransport.sendMail(mail, function(error, response) {\n        if (error) {\n            console.error(error.stack);\n        }\n        else {\n            console.log(\"Message sent: \" + response.message);\n        }\n\n        smtpTransport.close();\n    });\n    // var html = res.render('feedback',{name:req.body.firstName});\n    var mailToTeam = {\n        from: \"Pally <team@pallyapp.com>\",\n        to: \"team@pallyapp.com\",\n        subject: \"Feedback for Pally\",\n        text: \"\",\n        html: \"<div class='rcmBody'>\\\n    <table width='590' border='0' align='center' cellpadding='0' cellspacing='0' style='border: solid 1px #dfdfdf; background: repeat center top'>\\\n        <tbody>\\\n            <tr>\\\n                <td valign='top'>\\\n                    <table width='100%' border='0' cellspacing='0' cellpadding='15'>\\\n                        <tbody>\\\n                            <tr>\\\n                                <td valign='top' style='font-family: Arial, Tahoma; font-size: 13px; color: #484848; line-height: 18px'>\\\n                                    <h2 style='color: #A2BC8D'>Thank You</h2>\\\n                                    <table>\\\n                                        <tbody>\\\n                                            <tr>\\\n                                                <td>Hi Team!\\\n                                                    <br>\\\n                                                    <br> There is a new feedback from our user \" + req.body.firstName + \" \\\n                                                    <br> <b>First Name:</b> \" + req.body.firstName + \" <b> Last Name:</b>  \" + req.body.lastName + \"\\\n                                                    <br> <b>Email:</b> \" + req.body.userEmail + \"\\\n                                                    <br> <b>Mobile:</b> \" + req.body.mobileNumber + \"\\\n                                                    <br><br> <b>Message:</b> \" + req.body.message + \"\\\n                                                    <br>\\\n                                                    <br>\\\n                                                    <br>Thanks,\\\n                                                    <br>Team Pally</td>\\\n                                            </tr>\\\n                                        </tbody>\\\n                                    </table>\\\n                                </td>\\\n                            </tr>\\\n                        </tbody>\\\n                    </table>\\\n                </td>\\\n            </tr>\\\n            <tr>\\\n                <td valign='top' style='border-top: solid 1px #dfdfdf; padding: 10px'>\\\n                    <table width='100%' border='0' cellspacing='0' cellpadding='0'>\\\n                        <tbody>\\\n                            <tr>\\\n                                <td width='56%' valign='middle'>\\\n                                </td>\\\n                                <td width='44%' align='right' valign='middle' style='font-family: arial, tahoma; color: #afafb0; font-size: 11px'>Copyrights 2015 pallyapp.com. All Rights Reserved.</td>\\\n                            </tr>\\\n                        </tbody>\\\n                    </table>\\\n                </td>\\\n            </tr>\\\n        </tbody>\\\n    </table>\\\n</div>\"\n    };\n\n    smtpTransport.sendMail(mailToTeam, function(error, response) {\n        if (error) {\n            console.error(error.stack);\n        }\n        else {\n            console.log(\"Message sent: \" + response.message);\n        }\n\n        smtpTransport.close();\n    });\n\n\n\n    res.render(\"index.html\");\n});\n\napp.listen(port, function(err) {\n    if (err) {\n        console.log(err.message);\n    }\n    console.log(\"Listening on port %s\", port);\n});","undoManager":{"mark":-2,"position":1,"stack":[[{"start":{"row":0,"column":0},"end":{"row":84,"column":0},"action":"remove","lines":["//","// # SimpleServer","//","// A simple chat server using Socket.IO, Express, and Async.","//","var http = require('http');","var path = require('path');","","var async = require('async');","var socketio = require('socket.io');","var express = require('express');","","//","// ## SimpleServer `SimpleServer(obj)`","//","// Creates a new instance of SimpleServer with the following options:","//  * `port` - The HTTP port to listen on. If `process.env.PORT` is set, _it overrides this value_.","//","var router = express();","var server = http.createServer(router);","var io = socketio.listen(server);","","router.use(express.static(path.resolve(__dirname, 'client')));","var messages = [];","var sockets = [];","","io.on('connection', function (socket) {","    messages.forEach(function (data) {","      socket.emit('message', data);","    });","","    sockets.push(socket);","","    socket.on('disconnect', function () {","      sockets.splice(sockets.indexOf(socket), 1);","      updateRoster();","    });","","    socket.on('message', function (msg) {","      var text = String(msg || '');","","      if (!text)","        return;","","      socket.get('name', function (err, name) {","        var data = {","          name: name,","          text: text","        };","","        broadcast('message', data);","        messages.push(data);","      });","    });","","    socket.on('identify', function (name) {","      socket.set('name', String(name || 'Anonymous'), function (err) {","        updateRoster();","      });","    });","  });","","function updateRoster() {","  async.map(","    sockets,","    function (socket, callback) {","      socket.get('name', callback);","    },","    function (err, names) {","      broadcast('roster', names);","    }","  );","}","","function broadcast(event, data) {","  sockets.forEach(function (socket) {","    socket.emit(event, data);","  });","}","","server.listen(process.env.PORT || 3000, process.env.IP || \"0.0.0.0\", function(){","  var addr = server.address();","  console.log(\"Chat server listening at\", addr.address + \":\" + addr.port);","});",""],"id":2},{"start":{"row":0,"column":0},"end":{"row":184,"column":3},"action":"insert","lines":["var express = require('express'),","    app = express(),","    fs = require(\"fs\"),","    mailer = require(\"nodemailer\"),","    port = process.env.PORT || 8080,","    mongoose = require('mongoose');","","require(\"./models/todo\");","var todoController = require('./controllers/todo');","","mongoose.connect(\"mongodb://arjun:@rJun@ds029793.mongolab.com:29793/pally\");","// mongodb://<dbuser>:<dbpassword>@ds029793.mongolab.com:29793/pally","// mongodb://<user>:<password>@ds045027.mongolab.com:45027/database","app.use(express.json());","app.use(express.urlencoded());","app.use(express.logger());","app.set('view engine', 'ejs');","","// Email settings","var smtpTransport = mailer.createTransport(\"SMTP\", {","    service: \"gmail\",","    auth: {","        user: \"noreply.pallyapp@gmail.com\",","        pass: \"pally@123\"","    }","});","","","//Requests","","app.get(\"/index\", function(req, res) {","    res.render('index.html');","});","","app.get(\"/meet_our_team\", function(req, res) {","    res.render('meet_our_team.html');","});","","","app.get(\"/talkToUs\", function(req, res) {","    res.render('talkToUs.html');","});","","app.get(\"/privacy\", function(req, res) {","    res.render('privacy.html');","});","","app.get(\"/what_is_pally\", function(req, res) {","    res.render('what_is_pally.html');","});","","app.post('/sendEmail', function(req, res) {","    console.log(req.body.userEmail);","    // Use Smtp Protocol to send Email","    // var smtpTransport = mailer.createTransport(\"SMTP\",{","    //     host: 'smtp.pallyapp.com',","    //     port: 25,","    //     auth: {","    //         user: 'team@pallyapp.com',","    //         pass: 'brooklyn88'","    //     }","    // });","","    var mail = {","        from: \"Pally <team@pallyapp.com>\",","        to: req.body.userEmail,","        subject: \"Thank You!\",","        text: \"Hi there!\\nThank you for signing up to Pally! We'll be launching to the public soon. Sit tight for our updates! Oh, and we promise to never spam you with useless information.\\nWith love,\\nTeam Pally\",","        html: fs.readFileSync('./client/thankYouSignup.html').toString()","    };","","    smtpTransport.sendMail(mail, function(error, response) {","        if (error) {","            console.error(error.stack);","        }","        else {","            console.log(\"Message sent: \" + response.message);","        }","","        smtpTransport.close();","    });","    // subscriber(req.body);","    res.render(\"index.html\");","});","","app.post('/sendFeedback', function(req, res) {","    console.log(req.body.userEmail);","","    var mail = {","        from: \"Pally <team@pallyapp.com>\",","        to: req.body.userEmail,","        subject: \"Thank You for your Feedback!\",","        text: \"Hi there!\\nThank you for your interest in Pally! One of our team members will review your message and get back to you as soon as possible (usually within 24 hours).\\nIn the meantime, please tell your friends about Pally!\\nSincerely,\\nTeam Pally\",","        html: fs.readFileSync('./client/thankYouFeedback.html').toString()","    };","","    smtpTransport.sendMail(mail, function(error, response) {","        if (error) {","            console.error(error.stack);","        }","        else {","            console.log(\"Message sent: \" + response.message);","        }","","        smtpTransport.close();","    });","    // var html = res.render('feedback',{name:req.body.firstName});","    var mailToTeam = {","        from: \"Pally <team@pallyapp.com>\",","        to: \"team@pallyapp.com\",","        subject: \"Feedback for Pally\",","        text: \"\",","        html: \"<div class='rcmBody'>\\","    <table width='590' border='0' align='center' cellpadding='0' cellspacing='0' style='border: solid 1px #dfdfdf; background: repeat center top'>\\","        <tbody>\\","            <tr>\\","                <td valign='top'>\\","                    <table width='100%' border='0' cellspacing='0' cellpadding='15'>\\","                        <tbody>\\","                            <tr>\\","                                <td valign='top' style='font-family: Arial, Tahoma; font-size: 13px; color: #484848; line-height: 18px'>\\","                                    <h2 style='color: #A2BC8D'>Thank You</h2>\\","                                    <table>\\","                                        <tbody>\\","                                            <tr>\\","                                                <td>Hi Team!\\","                                                    <br>\\","                                                    <br> There is a new feedback from our user \" + req.body.firstName + \" \\","                                                    <br> <b>First Name:</b> \" + req.body.firstName + \" <b> Last Name:</b>  \" + req.body.lastName + \"\\","                                                    <br> <b>Email:</b> \" + req.body.userEmail + \"\\","                                                    <br> <b>Mobile:</b> \" + req.body.mobileNumber + \"\\","                                                    <br><br> <b>Message:</b> \" + req.body.message + \"\\","                                                    <br>\\","                                                    <br>\\","                                                    <br>Thanks,\\","                                                    <br>Team Pally</td>\\","                                            </tr>\\","                                        </tbody>\\","                                    </table>\\","                                </td>\\","                            </tr>\\","                        </tbody>\\","                    </table>\\","                </td>\\","            </tr>\\","            <tr>\\","                <td valign='top' style='border-top: solid 1px #dfdfdf; padding: 10px'>\\","                    <table width='100%' border='0' cellspacing='0' cellpadding='0'>\\","                        <tbody>\\","                            <tr>\\","                                <td width='56%' valign='middle'>\\","                                </td>\\","                                <td width='44%' align='right' valign='middle' style='font-family: arial, tahoma; color: #afafb0; font-size: 11px'>Copyrights 2015 pallyapp.com. All Rights Reserved.</td>\\","                            </tr>\\","                        </tbody>\\","                    </table>\\","                </td>\\","            </tr>\\","        </tbody>\\","    </table>\\","</div>\"","    };","","    smtpTransport.sendMail(mailToTeam, function(error, response) {","        if (error) {","            console.error(error.stack);","        }","        else {","            console.log(\"Message sent: \" + response.message);","        }","","        smtpTransport.close();","    });","","","","    res.render(\"index.html\");","});","","app.listen(port, function(err) {","    if (err) {","        console.log(err.message);","    }","    console.log(\"Listening on port %s\", port);","});"]}],[{"start":{"row":10,"column":0},"end":{"row":10,"column":3},"action":"insert","lines":["// "],"id":3}]]},"ace":{"folds":[{"start":{"row":19,"column":52},"end":{"row":25,"column":0},"placeholder":"..."},{"start":{"row":51,"column":43},"end":{"row":83,"column":0},"placeholder":"..."},{"start":{"row":85,"column":46},"end":{"row":177,"column":0},"placeholder":"..."}],"scrolltop":387.5,"scrollleft":0,"selection":{"start":{"row":24,"column":5},"end":{"row":24,"column":5},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1448860054268}